# A Study About the Selection of Resources for the Detection of WannaCry, Ryuk and CryptoLocker Ransomwares

The following repository represents some code and results from it. The same is portrayed from the research on detection of ransonware, starting with the research about the characteristics of the ransonware WannaCry, Ryuk and CryptoLocker. This work aims to identify the representative features for detection of the aforementioned ransomware. To this end, the Cuckoo Sandbox tool is used to capture the behavior of binary files without malicious code and ransomware. From this, such behavior was registered through the generation of a dataset. The results obtained through the Information Gain (IG) feature selection algorithm reveal which are the 20 most relevant features among 170 features for detection of the studied malware.
O fluxo de execução do código acima é o seguinte:

1. Sample JSON file of each binary is generated by [Cuckoo Sandbox](https://cuckoosandbox.org).
2. Initialization of the main function and call of the capture_column function 'Function created to capture all the features for filtering it'.
```py 
def captura_colunas(dir_list):
    """
    Função que lê uma lista de arquivos JSON e retorna uma lista das colunas a serem incluídas no arquivo CSV de saída
    """
    colunas = []
    for arquivo in dir_list:
        with open(arquivo, 'r', encoding='utf8') as f:
            # Leitura do arquivo JSON
            data = json.load(f) 
            for i in data['behavior']['processes']:
                for j in i['calls']:
                    api = j['api']
                    if api not in colunas:
                        colunas.append(api)
    return colunas
```
3. Function json_arq 'Function created to read the JSON files from a given directory and process the data to create an informative table'
  ```py
def json_arq(dir_arq, colunas):
    with open('Data-set-TesteTCLimpos.csv', 'a', newline='', encoding='utf-8') as arquivo_csv:
        writer = csv.writer(arquivo_csv)
        col_aux = ['command_line', 'score_binary']
        writer.writerow(col_aux + colunas)
        
        for arquivo in dir_arq:
            print("Nome do arquivo: " + arquivo) #-- Nome do arquivo
            with open(arquivo,'r', encoding='utf8') as f:
                #-- Instanciando uma variável que recebera a leitura do arquivo JSON
                data = json.load(f) 	
                for i, process in enumerate(data['behavior']['processes']):
                    # Comando utilizado pelo binário
                    command_line = process['command_line']
                    # Score do binário
                    score = data['info']['score']
                    print("========================================")
                    print("-> Processo " + str(i))
                    print("========================================")
                    calls = [call['api'] for call in process['calls']]
                    numeros = [calls.count(coluna) for coluna in colunas]
                    writer.writerow([command_line, score] + numeros)
  ```

## Starting 

The Figure illustrates the experimentation scenario, which involves uploading binaries (binary.exe) to the tool and creating virtual machines through the VirtualBox software. The tool has an agent, created in Python, which monitors and captures all content and changes made by the binary during its execution. The tool in question is installed on a Dell Inspiron 15 3000 computer with Ubuntu 18.04 operating system.

![cuckoo drawio (2)](https://user-images.githubusercontent.com/51774020/222503136-20e0b5c2-c32f-42ee-bb48-5cfd0ae124e4.png)


Finally, the Jupyterlab development environment with the Python language was used to process the report resulting from the Cuckoo analysis. Such a report is generated in JavaScript Object Notation (JSON) format. From this file, 170 features were selected, such as system calls and operations performed by each executed binary. In this way, it was possible to build a dataset with malicious and legitimate samples (typical applications for common users).

In order to process the report resulting from the Cuckoo analysis, a script in the Python language called script.py was implemented, which is available in the aforementioned repository. Such a report, which is illustrated in the Figure, is generated in JavaScript Object Notation (JSON) format. From this file, 226 features were selected for WannaCry, 211 for Ryuk and also 211 CryptoLock, such as system calls and operations performed by each executed binary. In this way, it was possible to build 3 datasets with malicious (WannaCry, Ryuk, CryptoLocker) and legitimate samples (typical applications for common users). It is important to highlight that each generated dataset contains samples related to 35 legitimate binaries and 1 malicious binary. Therefore, what changes from one dataset to another are the malicious binary samples. That is, each dataset has samples of only one of the malicious binaries, in addition to samples relating to 35 legitimate binaries, which are the same for each database.

## Prerequisites

To run the created script, it is recommended to install the [Anaconda](https://www.anaconda.com/products/distribution) software and that the machine you are using has at least 8GB of RAM memory.

## Settings
First, you need to download the entire repository onto your machine.

Follow the steps shown below:

1 - On Windows, we will enter the repository in question, go to '<> code' and download the ZIP:
![githubcerto1](https://user-images.githubusercontent.com/51774020/222516384-c7829379-c5a8-4367-b400-dee54f5e7976.gif)

2 - In the location you want, we will extract all the files.
![image](https://user-images.githubusercontent.com/51774020/222519289-ab2eb524-e8a6-430f-a43a-77a1b9767e79.png)

When running the recommended software, we will use JupyterLab to execute and visualize our features. (Image illustrated below)
![githubgif](https://user-images.githubusercontent.com/51774020/222509797-9426c199-a253-4c82-8728-6cc57d2db0bb.gif)

![githubcerto3](https://user-images.githubusercontent.com/51774020/222519569-24796901-5d5a-442a-84b0-c05e6dc06264.gif)

Now, it is necessary to download the reports referring to the non-malicious binaries, which are available at the url below. GitHub has a file size limiter, so it's included in Google Drive:

[Clique aqui](https://drive.google.com/drive/folders/1LcO4pn-Op9xZvBIw7NUQFFybP99dZ58B?usp=share_link) e baixe os reports.
![githubcerto4](https://user-images.githubusercontent.com/51774020/222520921-9c5a89bd-36e7-454d-8b66-b25ec0f21215.gif)

![image](https://user-images.githubusercontent.com/51774020/222522272-6ad38570-3650-419b-889c-411bff79a8bd.png)

## Running

In JupyterLab, we will start executing the stript in question. in the 'main()' function, it is necessary for the reader to insert the location of the file in the folder where the JSON files are.

![image](https://user-images.githubusercontent.com/51774020/222523108-1651262c-6f2a-4909-839e-e5d1b59b0734.png)

Also change the name which will be the name of the referring CSV file

![image](https://user-images.githubusercontent.com/51774020/222524473-0061e80d-c54d-4006-9a76-87875eb9baa7.png)

Right after all the configuration, it's time to run. Just press CTRL+ENTER. The code will be in operation, and soon after, two result files will be created:

![image](https://user-images.githubusercontent.com/51774020/222534243-355ba71c-1c59-4e4b-8046-953440fbbfe5.png)

## Binaries

Malware can be found through the platform of [VirusShare](https://virusshare.com)

1. WannaCry             - 84c82835a5d21bbcf75a61706d8ab549
2. CryptoLocker         - c359a944d8c482b0bed83996cef3d2ca
3. Ryuk                 - f62bb82db62dd6b80908dcd79ea51fb2

The binaries that were run are binaries that were run on the Cuckoo Sandbox online tool and popular tools, below we will be providing the MD5 hashes of each non-malicious binary. The collection of binaries was carried out in two ways, 15 of them were taken from binaries commonly used by users, such as (Google, Safari, Firefox, Opera, OperaGX, etc.), the other binaries were collected through the tool [Cukoo Sandbox online](https://cuckoo.cert.ee/analysis/). A collection was carried out through the analysis of binaries that have the lowest scores of the same and it was executed in the Cuckoo Sandbox that was installed in our machine, to show if the binary really does not have a low score and that it does not have malicious actions.

1.  232375fbdc2980ecd442d64ade1d5b3d
2.  5cce735d2c777c89e4cd11de55040891
3.  0bbcb8517d197ca042ec768c3f4566b3
4.  5c12cdf9b3313ef407151bfb22c883ef
5.  9fdca2eff2bac21d71a89d28518110bc
6.  ba736eea008423b9f1812157c311985a
7.  f9448ca2887ece5ca0c0e17f88e926a8
8.  7a0dfc5353ff6de7de0208a29fa2ffc9
9.  5790aabc5d5126ac5358324888275f54
10. fee11f37a9f3527f23f3b88ed6690a9a
11. 2f1d549c993a1360f241f8f119bb0e41
12. 8d26a0efa7369000827b3642eccf82af
13. f69d2d5185414faabcb5d4a07c78dea4
14. 42c383425dd636200dc1c0b30b3f7b14
15. a09e62520db5469a3dff49e8e3f2ac7c
16. 1af5d7d5a5e6efda0fd2cc763be8dd6f
17. e2d7e115c852f8d2f956afb600b51e7e
18. 13388b26b03e3384650a4ae0e3df37be
19. 31b3069cef380b4bf85e75a8885bcee8
20. 8a2ad04c5c1529183ee2e1a2245a0a8a
21. 0477dc80d3f44e28f0bccbb6b3d3d2a7
22. baca971eb8473ee7364db9c060fcde07
23. 411f46b0ffa685494f4149649b71550d
24. d5382d619115cf605dda008f532f867a
25. 382512660e69cb770579f0e16a94ed66
26. 56af723d25b24ac57452f8a66c59dab4
27. 68e6a5a62580ffa81e810f4e9feccf47
28. cb544cff55d55421cb615905e53ad45a
29. cc66e41c9e1317470a15ea229cc9e223
30. 91eed1131ead9f2b858ddab531bea037
31. 468f8b574c793e2d52af108f1a352d07
32. e2b8917b8544d1150c832d7563c76beb
33. 5ad27aff27dd768189be9c00c7e7a0af
34. 77db51e334b21c0c3cccbffaa73d8483
35. f415f70e9db33a21d1b7dfaf9a3fa31e



